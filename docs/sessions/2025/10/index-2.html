<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Session Handout – Anesthesiology Journal Club</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../../../assets/js/tailwind-config.js"></script>

    <!-- Prevent flash of wrong theme -->
    <script>
        try{if(localStorage.theme==='dark'||(!localStorage.theme&&matchMedia('(prefers-color-scheme:dark)').matches))document.documentElement.classList.add('dark')}catch(e){}
    </script>

    <!-- Shared base styles -->
    <link rel="stylesheet" href="../../../assets/css/base.css" />

    <style>
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>

<body class="bg-white dark:bg-gray-950 text-slate-900 dark:text-gray-100 antialiased font-sans">

<!-- Skip link -->
<a href="#main-content"
   class="sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 rounded bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow">
    Skip to main content
</a>

<!-- ================= HEADER ================= -->
<header class="sticky top-0 z-50 bg-black/95 backdrop-blur text-white">
    <nav class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8"
         aria-label="Primary navigation">
        <div class="flex h-12 items-center justify-between">
            <div class="flex items-center gap-1.5">
                <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <a href="../../../" class="text-sm font-medium tracking-tight hover:text-gray-300 transition-colors">
                    Anesthesiology Journal Club
                </a>
            </div>

            <!-- Desktop nav -->
            <div class="hidden md:flex items-center gap-6">
                <ul class="flex items-center gap-7 text-xs">
                    <li><a href="../../../#overview" class="text-gray-300 hover:text-white transition-colors">Overview</a></li>
                    <li><a href="../../../#featured" class="text-gray-300 hover:text-white transition-colors">Featured Sessions</a></li>
                    <li><a href="../../../#schedule" class="text-gray-300 hover:text-white transition-colors">Schedule</a></li>
                    <li><a href="../../../#archive" class="text-gray-300 hover:text-white transition-colors">Archive</a></li>
                    <li><a href="../../../dev/resources/" class="text-gray-300 hover:text-white transition-colors">Resources</a></li>
                </ul>

                <!-- Theme toggle (desktop) -->
                <button data-theme-toggle
                        class="ml-2 inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-400 hover:text-white hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-white"
                        aria-label="Toggle dark mode">
                    <svg class="h-4 w-4 block dark:hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
                    </svg>
                    <svg class="h-4 w-4 hidden dark:block" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/>
                    </svg>
                </button>
            </div>

            <!-- Mobile: theme toggle + menu button -->
            <div class="flex md:hidden items-center gap-1">
                <button data-theme-toggle
                        class="inline-flex h-10 w-10 items-center justify-center rounded text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-white"
                        aria-label="Toggle dark mode">
                    <svg class="h-5 w-5 block dark:hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
                    </svg>
                    <svg class="h-5 w-5 hidden dark:block" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/>
                    </svg>
                </button>

                <button id="menuButton"
                        class="inline-flex h-10 w-10 items-center justify-center rounded focus:outline-none focus:ring-2 focus:ring-white"
                        aria-label="Open menu"
                        aria-expanded="false"
                        aria-controls="mobile-menu">
                    <svg width="24" height="24" fill="none" aria-hidden="true">
                        <path d="M4 6h16M4 12h16M4 18h16"
                              stroke="currentColor"
                              stroke-width="2"
                              stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </nav>
</header>

<!-- Mobile menu dialog -->
<div id="mobile-menu"
     class="fixed inset-0 z-[100] hidden"
     role="dialog"
     aria-modal="true"
     aria-labelledby="mobile-menu-title">
    <div class="absolute inset-0 bg-black/60" id="menuBackdrop" aria-hidden="true"></div>
    <div class="absolute right-0 top-0 h-full w-80 bg-white dark:bg-gray-900 text-slate-900 dark:text-gray-100 shadow-xl">
        <div class="flex items-center justify-between border-b border-gray-200 dark:border-gray-700 px-4 py-4">
            <h2 id="mobile-menu-title" class="text-sm font-semibold">
                Navigation
            </h2>
            <button id="closeMenu"
                    class="h-10 w-10 rounded focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white"
                    aria-label="Close menu">
                <svg width="24" height="24" fill="none" aria-hidden="true">
                    <path d="M6 6l12 12M18 6L6 18"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"/>
                </svg>
            </button>
        </div>
        <ul class="px-4 py-6 space-y-4 text-sm">
            <li><a href="../../../#overview" class="block hover:text-blue-500 dark:hover:text-blue-400">Overview</a></li>
            <li><a href="../../../#featured" class="block hover:text-blue-500 dark:hover:text-blue-400">Featured Sessions</a></li>
            <li><a href="../../../#schedule" class="block hover:text-blue-500 dark:hover:text-blue-400">Schedule</a></li>
            <li><a href="../../../#archive" class="block hover:text-blue-500 dark:hover:text-blue-400">Archive</a></li>
            <li><a href="../../../dev/resources/" class="block hover:text-blue-500 dark:hover:text-blue-400">Resources</a></li>
        </ul>
    </div>
</div>

<!-- ================= MAIN ================= -->
<main id="main-content" class="mx-auto max-w-4xl px-6 py-12">

    <!-- Breadcrumb -->
    <nav aria-label="Breadcrumb" class="mb-5 text-sm text-slate-500 dark:text-gray-400">
        <ol class="flex flex-wrap items-center gap-2">
            <li><a href="../../../" class="hover:text-blue-500 dark:hover:text-blue-400">Home</a></li>
            <li aria-hidden="true" class="text-slate-300 dark:text-gray-600">/</li>
            <li class="font-medium text-slate-700 dark:text-gray-300">Session Handout</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <header class="mb-10">
        <h1 id="sessionTitle" class="font-display text-3xl sm:text-4xl font-semibold leading-tight tracking-tight">
            Session Handout
        </h1>
        <p id="sessionSubtitle" class="mt-3 text-lg text-slate-600 dark:text-gray-400 hidden"></p>
        <p id="jcDate" class="mt-2 text-sm text-slate-500 dark:text-gray-400 hidden"></p>

        <div id="statusBanner" class="no-print hidden mt-4 px-4 py-2 rounded-lg font-semibold text-sm inline-block"></div>

        <div id="presenters" class="mt-3 text-sm text-slate-700 dark:text-gray-300 font-medium hidden"></div>
        <div id="faculty" class="text-sm text-slate-600 dark:text-gray-400 italic hidden"></div>
        <div id="countdownBox" class="no-print hidden mt-4 bg-gray-100 dark:bg-gray-800 text-blue-700 dark:text-blue-300 font-semibold rounded-lg py-3 px-4 inline-block">
            <p id="countdown" class="text-center"></p>
        </div>
    </header>

    <!-- ================= CONTENT ================= -->
    <div class="space-y-16">

        <!-- Purpose -->
        <section id="purposeSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Purpose</h2>
            <p id="purposeText" class="mt-4 text-slate-700 dark:text-gray-300 leading-relaxed"></p>
        </section>

        <!-- Topic -->
        <section id="topicSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Topic</h2>
            <p id="topicText" class="mt-4 bg-blue-50 dark:bg-blue-900/20 text-blue-900 dark:text-blue-200 p-4 rounded-lg font-medium"></p>
        </section>

        <!-- Objectives -->
        <section id="objectivesSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Objectives</h2>
            <ol id="objectivesList" class="mt-4 list-decimal pl-6 space-y-3 text-sm text-slate-700 dark:text-gray-300"></ol>
        </section>

        <!-- Discussion -->
        <section id="discussionSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Discussion Highlights</h2>
            <ul id="discussionList" class="mt-4 list-disc pl-6 space-y-3 text-sm text-slate-700 dark:text-gray-300"></ul>
        </section>

        <!-- Articles -->
        <section id="articlesSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Articles for Review</h2>
            <div id="articleList" class="mt-4 space-y-4"></div>
        </section>

        <!-- Downloads -->
        <section id="downloadsSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Downloads</h2>
            <div id="downloadsList" class="mt-4 space-y-3"></div>
        </section>

        <!-- Pre-Work -->
        <section id="preworkSection" class="hidden">
            <h2 class="text-xl font-semibold border-b border-gray-200 dark:border-gray-800 pb-3">Pre-Work Instructions</h2>
            <div class="mt-4 bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-500 dark:border-amber-400 text-amber-900 dark:text-amber-200 p-4 sm:p-5 rounded-r-xl">
                <ul id="preworkList" class="list-disc list-inside space-y-2 text-sm"></ul>
            </div>
        </section>

    </div>

    <!-- Print button -->
    <div class="no-print mt-12 text-center">
        <button onclick="window.print()"
                class="inline-flex items-center gap-2 rounded-full border border-gray-300 dark:border-gray-600 px-5 py-2 text-sm font-semibold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
            Print Handout
        </button>
    </div>
</main>

<!-- ================= FOOTER ================= -->
<footer class="bg-black text-gray-400 border-t border-gray-800">
    <div class="mx-auto max-w-6xl px-6 py-4">
        <nav class="text-xs mb-4" aria-label="Breadcrumb">
            <ol class="flex items-center gap-2">
                <li>
                    <a href="../../../" class="hover:text-white transition-colors">Anesthesiology Journal Club</a>
                </li>
                <li class="text-gray-600">&rsaquo;</li>
                <li class="text-gray-500">Session Handout</li>
            </ol>
        </nav>

        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 pt-3 border-t border-gray-800">
            <div class="flex flex-wrap gap-4 text-xs">
                <a href="#" class="hover:text-white transition-colors">Privacy Policy</a>
                <a href="#" class="hover:text-white transition-colors">Terms of Use</a>
                <a href="#" class="hover:text-white transition-colors">Contact</a>
            </div>
            <p class="text-xs text-gray-500">
                Copyright &copy; 2025 UC Davis Health. All rights reserved.
            </p>
        </div>
    </div>
</footer>

<!-- ================= JS ================= -->
<script src="../../../assets/js/theme-toggle.js"></script>
<script src="../../../assets/js/mobile-menu.js"></script>

<script>
    const jsonPath = '/journal-club/jason/JC-2025-10-14.json';

    fetch(jsonPath)
        .then(res => res.json())
        .then(data => populatePage(data))
        .catch(err => console.error('JSON load error:', err));

    function show(elId) {
        const el = document.getElementById(elId);
        if (el) el.classList.remove('hidden');
    }

    function populatePage(data) {
        // Title
        if (data.SESSION_TITLE) {
            document.title = (data.PAGE_TITLE || data.SESSION_TITLE) + ' – Anesthesiology Journal Club';
            document.getElementById('sessionTitle').textContent = data.SESSION_TITLE;
        }
        if (data.SESSION_SUBTITLE) {
            document.getElementById('sessionSubtitle').textContent = data.SESSION_SUBTITLE;
            show('sessionSubtitle');
        }
        if (data.JOURNAL_CLUB_DATE) {
            document.getElementById('jcDate').textContent = 'Date: ' + data.JOURNAL_CLUB_DATE;
            show('jcDate');
        }

        // Presenters & Faculty
        if (data.PRESENTERS?.length) {
            document.getElementById('presenters').innerHTML = '<strong>Presenters:</strong> ' + data.PRESENTERS.join(', ');
            show('presenters');
        }
        if (data.FACULTY?.length) {
            document.getElementById('faculty').innerHTML = '<strong>Faculty:</strong> ' + data.FACULTY.join(', ');
            show('faculty');
        }

        // Countdown and Status
        if (data.COUNTDOWN_DATE) {
            const sessionDate = new Date(data.COUNTDOWN_DATE);
            const now = new Date();
            const diff = sessionDate - now;
            const banner = document.getElementById('statusBanner');

            if (Math.abs(diff) < 3 * 60 * 60 * 1000) {
                banner.textContent = 'Session In Progress';
                banner.classList.add('bg-emerald-100', 'dark:bg-emerald-900/40', 'text-emerald-800', 'dark:text-emerald-200', 'border', 'border-emerald-300');
            } else if (diff > 0) {
                banner.textContent = 'Upcoming Session';
                banner.classList.add('bg-blue-100', 'dark:bg-blue-900/40', 'text-blue-800', 'dark:text-blue-200', 'border', 'border-blue-300');
            } else {
                banner.textContent = 'Session Completed';
                banner.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'border', 'border-gray-400');
            }
            show('statusBanner');
            show('countdownBox');
            startCountdown(data.COUNTDOWN_DATE);
        }

        // Purpose
        if (data.PURPOSE_TEXT) {
            document.getElementById('purposeText').textContent = data.PURPOSE_TEXT;
            show('purposeSection');
        }
        if (data.TOPIC_TEXT) {
            document.getElementById('topicText').textContent = data.TOPIC_TEXT;
            show('topicSection');
        }

        // Objectives
        if (data.OBJECTIVES_LIST?.length) {
            const list = document.getElementById('objectivesList');
            data.OBJECTIVES_LIST.forEach(i => {
                const li = document.createElement('li');
                li.textContent = i;
                list.appendChild(li);
            });
            show('objectivesSection');
        }

        // Discussion
        if (data.DISCUSSION_LIST?.length) {
            const list = document.getElementById('discussionList');
            data.DISCUSSION_LIST.forEach(i => {
                const li = document.createElement('li');
                li.textContent = i;
                list.appendChild(li);
            });
            show('discussionSection');
        }

        // Articles
        if (data.ARTICLE_LIST?.length) {
            const container = document.getElementById('articleList');
            data.ARTICLE_LIST.forEach(a => {
                const div = document.createElement('div');
                div.className = 'p-4 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-900';
                div.innerHTML = '<p class="font-semibold text-slate-900 dark:text-gray-100 mb-1">' + escapeHtml(a.title) + '</p>'
                    + '<a href="' + escapeHtml(a.url) + '" target="_blank" rel="noopener" class="text-blue-600 dark:text-blue-400 font-medium hover:underline text-sm">PubMed Link</a>';
                container.appendChild(div);
            });
            show('articlesSection');
        }

        // Downloads
        if (data.DOWNLOADS && Object.keys(data.DOWNLOADS).length > 0) {
            const dlList = document.getElementById('downloadsList');
            Object.entries(data.DOWNLOADS).forEach(([title, path]) => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-4 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-900';
                div.innerHTML = '<span class="font-medium text-slate-700 dark:text-gray-300">' + escapeHtml(title) + '</span>'
                    + '<a href="' + escapeHtml(path) + '" download class="rounded-full bg-blue-500 hover:bg-blue-600 text-white font-medium px-4 py-1.5 text-sm transition-colors">Download</a>';
                dlList.appendChild(div);
            });
            show('downloadsSection');
        }

        // Prework
        if (data.PREWORK_LIST?.length) {
            const list = document.getElementById('preworkList');
            data.PREWORK_LIST.forEach(i => {
                const li = document.createElement('li');
                li.textContent = i;
                list.appendChild(li);
            });
            show('preworkSection');
        }
    }

    function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

    function startCountdown(targetDate) {
        const countdownEl = document.getElementById('countdown');
        const t = new Date(targetDate).getTime();
        function update() {
            const now = new Date().getTime();
            const diff = t - now;
            if (diff <= 0) { countdownEl.textContent = 'Session Started!'; return; }
            const d = Math.floor(diff / (1000*60*60*24));
            const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
            const m = Math.floor((diff % (1000*60*60)) / (1000*60));
            const s = Math.floor((diff % (1000*60)) / 1000);
            countdownEl.textContent = d + 'd ' + h + 'h ' + m + 'm ' + s + 's';
        }
        update();
        setInterval(update, 1000);
    }
</script>
</body>
</html>
