<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="pageTitle"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <style>
        body { font-family: 'Inter', sans-serif; }
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .bg-white { box-shadow: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-300">

<!-- Logo -->
<div class="flex justify-center pt-6 pb-3">
    <img id="logoImage" alt="Brand Logo" class="h-14 sm:h-16 hidden" />
</div>

<!-- Theme Toggle -->
<div class="fixed top-4 right-4 z-50">
    <button id="themeToggle"
            class="bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 p-2 rounded-full shadow-md border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all duration-200"
            aria-label="Toggle theme">
        <svg class="w-5 h-5 sun-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
        </svg>
        <svg class="w-5 h-5 moon-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
        </svg>
    </button>
</div>

<!-- Main Card -->
<div class="max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 sm:p-8 mt-4 mb-10">

    <header class="text-center mb-8">
        <h1 id="sessionTitle" class="text-3xl sm:text-4xl font-extrabold text-gray-900 dark:text-gray-100 mb-2 hidden"></h1>
        <p id="sessionSubtitle" class="text-base sm:text-lg text-gray-600 dark:text-gray-400 italic mb-2 hidden"></p>
        <p id="jcDate" class="text-sm text-gray-500 dark:text-gray-400 mb-2 hidden"></p>

        <div id="statusBanner" class="no-print hidden px-4 py-2 rounded-lg font-semibold text-sm inline-block mb-3"></div>

        <div id="presenters" class="text-sm text-gray-700 dark:text-gray-300 font-medium hidden"></div>
        <div id="faculty" class="text-sm text-gray-600 dark:text-gray-400 italic mb-3 hidden"></div>
        <div id="countdownBox" class="no-print hidden bg-gray-100 dark:bg-gray-700 text-sky-800 dark:text-sky-200 font-semibold rounded-lg py-3 px-4 inline-block mt-2">
            <p id="countdown" class="text-center"></p>
        </div>
    </header>

    <!-- Purpose -->
    <section id="purposeSection" class="mb-8 hidden">
        <h2 class="text-xl font-semibold text-sky-800 dark:text-sky-300 border-b border-sky-300 dark:border-sky-600 pb-1 mb-4">Purpose</h2>
        <p id="purposeText" class="text-gray-700 dark:text-gray-300 leading-relaxed"></p>
    </section>

    <hr class="border-gray-200 dark:border-gray-700 my-6 hidden" id="divider1" />

    <!-- Topic -->
    <section id="topicSection" class="mb-8 hidden">
        <h2 class="text-xl font-semibold text-sky-800 dark:text-sky-300 border-b border-sky-300 dark:border-sky-600 pb-1 mb-4">Topic</h2>
        <p id="topicText" class="bg-sky-50 dark:bg-sky-900/20 text-sky-900 dark:text-sky-200 p-4 rounded-lg font-medium shadow-sm"></p>
    </section>

    <hr class="border-gray-200 dark:border-gray-700 my-6 hidden" id="divider2" />

    <!-- Objectives -->
    <section id="objectivesSection" class="mb-8 hidden">
        <h2 class="text-xl font-semibold text-sky-800 dark:text-sky-300 border-b border-sky-300 dark:border-sky-600 pb-1 mb-4">Objectives</h2>
        <ol id="objectivesList" class="list-decimal pl-6 space-y-3 text-gray-700 dark:text-gray-300"></ol>
    </section>

    <hr class="border-gray-200 dark:border-gray-700 my-6 hidden" id="divider3" />

    <!-- Discussion -->
    <section id="discussionSection" class="mb-8 hidden">
        <h2 class="text-xl font-semibold text-sky-800 dark:text-sky-300 border-b border-sky-300 dark:border-sky-600 pb-1 mb-4">Discussion Highlights</h2>
        <ul id="discussionList" class="list-disc pl-6 space-y-3 text-gray-700 dark:text-gray-300"></ul>
    </section>

    <hr class="border-gray-200 dark:border-gray-700 my-6 hidden" id="divider4" />

    <!-- Articles -->
    <section id="articlesSection" class="mb-8 hidden">
        <h2 class="text-xl font-semibold text-sky-800 dark:text-sky-300 border-b border-sky-300 dark:border-sky-600 pb-1 mb-4">Articles for Review</h2>
        <div id="articleList" class="space-y-4"></div>
    </section>

    <hr class="border-gray-200 dark:border-gray-700 my-6 hidden" id="divider5" />

    <!-- Downloads -->
    <section id="downloadsSection" class="mb-8 hidden">
        <h2 class="text-xl font-semibold text-emerald-800 dark:text-emerald-300 border-b border-emerald-300 dark:border-emerald-600 pb-1 mb-4">Downloads</h2>
        <div id="downloadsList" class="space-y-3"></div>
    </section>

    <hr class="border-gray-200 dark:border-gray-700 my-6 hidden" id="divider6" />

    <!-- Pre-Work -->
    <section id="preworkSection" class="hidden">
        <h2 class="text-xl font-semibold text-amber-800 dark:text-amber-300 border-b border-amber-300 dark:border-amber-600 pb-1 mb-4">Pre-Work Instructions</h2>
        <div class="bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-500 dark:border-amber-400 text-amber-900 dark:text-amber-200 p-4 sm:p-5 rounded-r-xl">
            <ul id="preworkList" class="list-disc list-inside space-y-2"></ul>
        </div>
    </section>

    <footer id="footer" class="text-center mt-10 pt-6 border-t border-gray-200 dark:border-gray-700 hidden">
        <p id="footerText" class="text-sm text-gray-500 dark:text-gray-400"></p>
        <button onclick="window.print()" class="mt-3 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 text-sm no-print">
            üñ®Ô∏è Print Handout
        </button>
    </footer>
</div>

<script>
    const jsonPath = '/journal-club/jason/JC-2025-10-14.json';

    fetch(jsonPath)
        .then(res => res.json())
        .then(data => populatePage(data))
        .catch(err => console.error('JSON load error:', err));

    function show(elId) {
        const el = document.getElementById(elId);
        if (el) el.classList.remove('hidden');
    }

    function populatePage(data) {
        // Title and Logo
        if (data.LOGO_PATH) { document.getElementById('logoImage').src = data.LOGO_PATH; show('logoImage'); }
        if (data.SESSION_TITLE) { document.title = data.PAGE_TITLE || data.SESSION_TITLE; document.getElementById('sessionTitle').textContent = data.SESSION_TITLE; show('sessionTitle'); }
        if (data.SESSION_SUBTITLE) { document.getElementById('sessionSubtitle').textContent = data.SESSION_SUBTITLE; show('sessionSubtitle'); }
        if (data.JOURNAL_CLUB_DATE) { document.getElementById('jcDate').textContent = `Date: ${data.JOURNAL_CLUB_DATE}`; show('jcDate'); }

        // Presenters & Faculty
        if (data.PRESENTERS?.length) { document.getElementById('presenters').innerHTML = `<strong>Presenters:</strong> ${data.PRESENTERS.join(', ')}`; show('presenters'); }
        if (data.FACULTY?.length) { document.getElementById('faculty').innerHTML = `<strong>Faculty:</strong> ${data.FACULTY.join(', ')}`; show('faculty'); }

        // Countdown and Status
        if (data.COUNTDOWN_DATE) {
            const sessionDate = new Date(data.COUNTDOWN_DATE);
            const now = new Date();
            const diff = sessionDate - now;
            const banner = document.getElementById('statusBanner');

            if (Math.abs(diff) < 3 * 60 * 60 * 1000) { // within 3 hours
                banner.textContent = 'üü¢ Session In Progress';
                banner.className += " bg-emerald-100 dark:bg-emerald-900/40 text-emerald-800 dark:text-emerald-200 border border-emerald-300";
            } else if (diff > 0) {
                banner.textContent = '‚è≥ Upcoming Session';
                banner.className += " bg-sky-100 dark:bg-sky-900/40 text-sky-800 dark:text-sky-200 border border-sky-300";
            } else {
                banner.textContent = '‚úÖ Session Completed';
                banner.className += " bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border border-gray-400";
            }
            show('statusBanner');
            show('countdownBox');
            startCountdown(data.COUNTDOWN_DATE);
        }

        // Purpose
        if (data.PURPOSE_TEXT) { document.getElementById('purposeText').textContent = data.PURPOSE_TEXT; show('purposeSection'); }
        if (data.TOPIC_TEXT) { document.getElementById('topicText').textContent = data.TOPIC_TEXT; show('topicSection'); }

        // Objectives
        if (data.OBJECTIVES_LIST?.length) {
            const list = document.getElementById('objectivesList');
            data.OBJECTIVES_LIST.forEach(i => { const li = document.createElement('li'); li.textContent = i; list.appendChild(li); });
            show('objectivesSection');
        }

        // Discussion
        if (data.DISCUSSION_LIST?.length) {
            const list = document.getElementById('discussionList');
            data.DISCUSSION_LIST.forEach(i => { const li = document.createElement('li'); li.textContent = i; list.appendChild(li); });
            show('discussionSection');
        }

        // Articles
        if (data.ARTICLE_LIST?.length) {
            const container = document.getElementById('articleList');
            data.ARTICLE_LIST.forEach(a => {
                const div = document.createElement('div');
                div.className = "p-4 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-800";
                div.innerHTML = `<p class="font-semibold text-gray-800 dark:text-gray-200 mb-1">${a.title}</p>
                           <a href="${a.url}" target="_blank" class="text-sky-600 dark:text-sky-400 font-medium hover:underline">PubMed Link</a>`;
                container.appendChild(div);
            });
            show('articlesSection');
        }

        // Downloads
        if (data.DOWNLOADS && Object.keys(data.DOWNLOADS).length > 0) {
            const dlList = document.getElementById('downloadsList');
            Object.entries(data.DOWNLOADS).forEach(([title, path]) => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center p-4 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50 dark:bg-gray-800";
                div.innerHTML = `<span class="font-medium text-gray-700 dark:text-gray-300">${title}</span>
                           <a href="${path}" download class="bg-emerald-600 hover:bg-emerald-700 text-white font-medium px-3 py-1 rounded-md text-sm">Download</a>`;
                dlList.appendChild(div);
            });
            show('downloadsSection');
        }

        // Prework
        if (data.PREWORK_LIST?.length) {
            const list = document.getElementById('preworkList');
            data.PREWORK_LIST.forEach(i => { const li = document.createElement('li'); li.textContent = i; list.appendChild(li); });
            show('preworkSection');
        }

        // Footer
        if (data.AUTHOR || data.INSTITUTION) {
            document.getElementById('footerText').textContent = `¬© ${data.AUTHOR || ''}${data.INSTITUTION ? ' ‚Äî ' + data.INSTITUTION : ''}`;
            show('footer');
        }
    }

    // Countdown
    function startCountdown(targetDate) {
        const countdownEl = document.getElementById('countdown');
        const t = new Date(targetDate).getTime();
        function update() {
            const now = new Date().getTime();
            const diff = t - now;
            if (diff <= 0) { countdownEl.textContent = 'Session Started!'; return; }
            const d = Math.floor(diff / (1000*60*60*24));
            const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
            const m = Math.floor((diff % (1000*60*60)) / (1000*60));
            const s = Math.floor((diff % (1000*60)) / 1000);
            countdownEl.textContent = `${d}d ${h}h ${m}m ${s}s`;
        }
        update();
        setInterval(update, 1000);
    }

    // Dark Mode Toggle
    class ThemeManager {
        constructor() {
            this.KEY = "theme";
            this.LIGHT = "light";
            this.DARK = "dark";
            this.toggle = document.getElementById("themeToggle");
            this.sun = document.querySelector(".sun-icon");
            this.moon = document.querySelector(".moon-icon");
            this.init();
        }
        init() {
            const pref = localStorage.getItem(this.KEY) || this.LIGHT;
            this.set(pref);
            this.toggle.addEventListener("click", () => this.toggleTheme());
        }
        set(theme) {
            document.documentElement.classList.toggle("dark", theme === this.DARK);
            localStorage.setItem(this.KEY, theme);
            this.sun.classList.toggle("hidden", theme !== this.DARK);
            this.moon.classList.toggle("hidden", theme === this.DARK);
        }
        toggleTheme() {
            const current = document.documentElement.classList.contains("dark") ? this.DARK : this.LIGHT;
            this.set(current === this.DARK ? this.LIGHT : this.DARK);
        }
    }
    new ThemeManager();
</script>
</body>
</html>